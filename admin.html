# Save the previously authored Admin panel as a standalone HTML for download.
admin_html = r"""<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Susanne 简介站点 · 后台管理</title>
<meta name="description" content="静态后台（中文）用于生成与发布 Susanne 的个人简介落地页。支持密码、可视化编辑、预览、下载 index.html、可选一键提交到 GitHub Pages。" />
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%230f172a'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-family='Segoe UI,Arial' font-size='26' font-weight='700' fill='white'%3ESR%3C/text%3E%3C/svg%3E" type="image/svg+xml">
<style>
  :root{
    --bg:#0b1220;--panel:#0f172a;--muted:#9aa2b2;--text:#e5e7eb;--line:#1f2937;--accent:#60a5fa;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444;
    --radius:14px;--shadow:0 16px 40px rgba(2,6,23,.45);--max:1200px;
  }
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  a{color:var(--accent);text-decoration:none}
  .wrap{max-width:var(--max);margin:24px auto;padding:0 16px}
  h1{font-size:clamp(22px,3.2vw,28px);margin:0 0 12px}
  .sub{color:var(--muted);margin-bottom:16px}
  .bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0 18px}
  .btn{background:#1f2937;border:1px solid #334155;color:#e5e7eb;padding:10px 14px;border-radius:10px;cursor:pointer}
  .btn.primary{background:#0a66c2;border-color:#1559a8}
  .btn.ok{background:#16a34a;border-color:#15803d}
  .btn.warn{background:#a16207;border-color:#854d0e}
  .btn.err{background:#b91c1c;border-color:#991b1b}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width: 920px){ .row{grid-template-columns:1fr} }
  .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
  .card h2{margin:0 0 10px}
  label{display:block;margin:8px 0 6px;color:#c7d2fe;font-weight:600}
  input[type=text], input[type=email], input[type=url], textarea{width:100%;background:#0b1324;color:#e5e7eb;border:1px solid #1f2937;border-radius:10px;padding:10px 12px}
  textarea{min-height:120px;resize:vertical}
  .pill{display:inline-block;background:#0b1324;border:1px solid #1f2937;padding:6px 10px;border-radius:999px;margin:4px 6px 0 0;color:#c7d2fe}
  .small{font-size:12px;color:var(--muted)}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
  .tab{background:#111827;border:1px solid #1f2937;color:#cbd5e1;border-radius:10px;padding:8px 12px;cursor:pointer}
  .tab.active{background:#0a66c2;border-color:#1559a8;color:#fff}
  .section{display:none}
  .section.active{display:block}
  .hr{border-top:1px dashed #223049;margin:14px 0}
  .list-item{border:1px dashed #334155;border-radius:10px;padding:10px;margin:8px 0}
  .right{display:flex;justify-content:flex-end;gap:8px}
  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  @media (max-width: 920px){ .grid-3{grid-template-columns:1fr} }
  .preview{width:100%;height:70vh;border:1px solid #223049;border-radius:12px;background:#0b1324}
  .help ul{margin:6px 0 0}
  .tag{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #334155;background:#101827;color:#9aa2b2;margin-left:8px}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
  .login{max-width:420px;margin:10vh auto;padding:20px;background:#0f172a;border:1px solid #1f2937;border-radius:16px;box-shadow:var(--shadow)}
</style>
</head>
<body>
<div id="loginView" class="login" hidden>
  <h2>后台登录</h2>
  <p class="small">此后台为 <b>静态页面</b>，仅作本地编辑/生成/可选推送 GitHub；不要当作高安全后台使用。</p>
  <div id="loginInit" hidden>
    <label>初始化新密码</label>
    <input id="initPwd1" type="password" placeholder="输入新密码">
    <label>确认新密码</label>
    <input id="initPwd2" type="password" placeholder="再次输入">
    <div class="right"><button class="btn ok" onclick="initPassword()">设为后台密码</button></div>
  </div>
  <div id="loginForm" hidden>
    <label>密码</label>
    <input id="loginPwd" type="password" placeholder="输入后台密码">
    <div class="right">
      <button class="btn" onclick="showReset()">重置/更换密码</button>
      <button class="btn primary" onclick="doLogin()">登录</button>
    </div>
  </div>
  <div id="loginReset" hidden>
    <label>旧密码</label>
    <input id="resetOld" type="password" placeholder="旧密码">
    <label>新密码</label>
    <input id="resetNew1" type="password" placeholder="新密码">
    <label>确认新密码</label>
    <input id="resetNew2" type="password" placeholder="再次输入">
    <div class="right"><button class="btn ok" onclick="resetPassword()">更换密码</button></div>
  </div>
  <div class="hr"></div>
  <div class="small">提示：密码仅存 <code>localStorage</code> 哈希；如更换浏览器/设备需重新初始化。为安全起见，建议将本后台文件 <b>不要</b> 放到公开目录，或使用临时文件名，使用后从仓库删除。</div>
</div>

<div id="app" class="wrap" hidden>
  <h1>Susanne 简介站点 · 后台管理 <span id="statusTag" class="tag">未预览</span></h1>
  <div class="sub">编辑内容 → 预览 → 下载 <code>index.html</code> 或（可选）提交到 GitHub Pages 仓库。</div>
  <div class="bar">
    <div class="tabs" id="tabs"></div>
    <div style="flex:1"></div>
    <button class="btn" onclick="saveDraft()">保存草稿</button>
    <button class="btn" onclick="loadDraft()">读取草稿</button>
    <button class="btn warn" onclick="clearDraft()">清空草稿</button>
    <button class="btn err" onclick="logout()">退出登录</button>
  </div>

  <div id="sections">
    <div class="section card" data-tab="站点与联系方式">
      <div class="row">
        <div>
          <h2>站点信息</h2>
          <label>站点标题</label>
          <input id="site_title" type="text" />
          <label>站点描述（用于 SEO）</label>
          <textarea id="site_desc"></textarea>
          <label>所在城市 / 地点</label>
          <input id="profile_location" type="text" />
        </div>
        <div>
          <h2>联系方式</h2>
          <label>邮箱</label>
          <input id="contact_email" type="email" />
          <label>LinkedIn URL</label>
          <input id="contact_linkedin" type="url" />
          <label>WhatsApp（纯数字，如 46764791451）</label>
          <input id="contact_wa_digits" type="text" />
          <label>WhatsApp 显示格式（如 +46 76 479 1451）</label>
          <input id="contact_wa_display" type="text" />
          <label>Facebook URL（可选）</label>
          <input id="contact_facebook" type="url" />
        </div>
      </div>
    </div>

    <div class="section card" data-tab="首屏与简介">
      <div class="row">
        <div>
          <h2>人物与头图</h2>
          <label>姓名</label>
          <input id="profile_name" type="text" />
          <label>标语（Tagline）</label>
          <input id="profile_tagline" type="text" />
          <label>首屏简介（1 段）</label>
          <textarea id="profile_lead"></textarea>
          <label>理念（1 段）</label>
          <textarea id="profile_philo"></textarea>
        </div>
        <div>
          <h2>头像 / 背景</h2>
          <label>头像（上传图片，自动转为 DataURL）</label>
          <input id="avatar_file" type="file" accept="image/*" />
          <div class="small">或直接粘贴头像 DataURL：</div>
          <textarea id="avatar_data" placeholder="data:image/..."></textarea>
          <div class="hr"></div>
          <label>自定义 Favicon（可选，DataURL）</label>
          <textarea id="favicon_data" placeholder="data:image/svg+xml;...（留空使用默认 SR 图标）"></textarea>
        </div>
      </div>
    </div>

    <div class="section card" data-tab="按钮与技能">
      <div class="row">
        <div>
          <h2>按钮开关</h2>
          <label><input id="btn_email" type="checkbox"/> 显示 Email 按钮</label>
          <label><input id="btn_linkedin" type="checkbox"/> 显示 LinkedIn 按钮</label>
          <label><input id="btn_whatsapp" type="checkbox"/> 显示 WhatsApp 按钮</label>
          <label><input id="btn_facebook" type="checkbox"/> 显示 Facebook 按钮</label>
        </div>
        <div>
          <h2>技能标签（逗号分隔）</h2>
          <textarea id="skills_tags" placeholder="例如：Multi‑asset portfolios & rebalancing, Risk budgeting & drawdown control, Liquidity management"></textarea>
        </div>
      </div>
    </div>

    <div class="section card" data-tab="经历与教育">
      <div class="grid-3">
        <div>
          <h2>工作经历</h2>
          <div id="exp_list"></div>
          <button class="btn" onclick="addExp()">+ 添加经历</button>
        </div>
        <div>
          <h2>教育背景</h2>
          <div id="edu_list"></div>
          <button class="btn" onclick="addEdu()">+ 添加教育</button>
        </div>
        <div>
          <h2>经验要点（首页三卡片）</h2>
          <label>卡片 1 标题</label>
          <input id="card1_t" type="text" />
          <label>卡片 1 内容</label>
          <textarea id="card1_c"></textarea>
          <label>卡片 2 标题</label>
          <input id="card2_t" type="text" />
          <label>卡片 2 内容</label>
          <textarea id="card2_c"></textarea>
          <label>卡片 3 标题</label>
          <input id="card3_t" type="text" />
          <label>卡片 3 内容</label>
          <textarea id="card3_c"></textarea>
        </div>
      </div>
    </div>

    <div class="section card" data-tab="预览与发布">
      <div class="row">
        <div>
          <h2>预览</h2>
          <div class="bar">
            <button class="btn ok" onclick="renderPreview()">生成并预览</button>
            <button class="btn" onclick="downloadHTML()">下载 index.html</button>
            <button class="btn" onclick="copyHTML()">复制 HTML</button>
          </div>
          <iframe id="preview" class="preview"></iframe>
        </div>
        <div>
          <h2>一键发布到 GitHub（可选）</h2>
          <div class="small">仅当你有该仓库推送权限；令牌只在你的浏览器内使用，不会发给第三方。</div>
          <label>仓库拥有者（owner）</label>
          <input id="gh_owner" type="text" placeholder="例如：susannarasmussen" />
          <label>仓库名（repo）</label>
          <input id="gh_repo" type="text" placeholder="例如：susannarasmussen.github.io" />
          <label>分支（branch）</label>
          <input id="gh_branch" type="text" value="main" />
          <label>文件路径（path）</label>
          <input id="gh_path" type="text" value="index.html" />
          <label>提交说明（commit message）</label>
          <input id="gh_msg" type="text" value="chore: update index.html via admin" />
          <label>GitHub 令牌（Fine-grained PAT，勾选 contents:read/write）</label>
          <input id="gh_token" type="password" placeholder="ghp_... 或 github_pat_..." />
          <div class="bar"><button class="btn primary" onclick="publishToGitHub()">提交到 GitHub</button></div>
          <div id="gh_status" class="small"></div>
          <div class="hr"></div>
          <div class="help small">
            <b>无需服务器：</b> GitHub Pages 仅支持静态文件。本后台在浏览器里生成 <code>index.html</code>；你也可以手动上传到仓库根目录覆盖。
            <ul>
              <li>仓库：<code>username.github.io</code>（用户/组织页），或普通仓库启用 Pages。</li>
              <li>生效：commit 后几秒到 1 分钟内刷新即可看到更新。</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="section card" data-tab="数据导入导出">
      <h2>草稿与配置</h2>
      <div class="bar">
        <button class="btn" onclick="saveDraft()">保存到本地（localStorage）</button>
        <button class="btn" onclick="loadDraft()">读取本地</button>
        <button class="btn warn" onclick="clearDraft()">清空本地</button>
      </div>
      <label>导出 JSON</label>
      <textarea id="json_out" readonly></textarea>
      <div class="right"><button class="btn" onclick="exportJSON()">导出到上方文本框</button></div>
      <label>导入 JSON</label>
      <textarea id="json_in" placeholder='粘贴 JSON 配置…'></textarea>
      <div class="right"><button class="btn ok" onclick="importJSON()">导入并覆盖表单</button></div>
      <div class="hr"></div>
      <div class="small">隐私说明：所有数据只保存在你的浏览器本地或你提交到的 GitHub 仓库中。</div>
    </div>
  </div>
</div>

<script>
  // ======== 工具函数 ========
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const enc = s => new TextEncoder().encode(s);
  const toHex = buf => Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
  const sha256 = async (s)=> toHex(await crypto.subtle.digest('SHA-256', enc(s)));
  const LS = {
    pwd: 'sr_admin_pwd_hash',
    cfg: 'sr_admin_config',
    logged: 'sr_admin_logged',
  };

  // ======== 登录与密码 ========
  async function boot(){
    const hasPwd = !!localStorage.getItem(LS.pwd);
    $('#loginView').hidden = false;
    $('#loginInit').hidden = hasPwd;
    $('#loginForm').hidden = !hasPwd;
  }
  async function initPassword(){
    const a = $('#initPwd1').value.trim();
    const b = $('#initPwd2').value.trim();
    if(!a || a!==b){ alert('两次输入不一致'); return; }
    const h = await sha256(a);
    localStorage.setItem(LS.pwd, h);
    alert('已设置后台密码');
    location.reload();
  }
  function showReset(){
    $('#loginReset').hidden = false;
  }
  async function resetPassword(){
    const old = $('#resetOld').value.trim();
    const hOld = await sha256(old);
    const saved = localStorage.getItem(LS.pwd)||'';
    if(hOld!==saved){ alert('旧密码不正确'); return; }
    const a = $('#resetNew1').value.trim();
    const b = $('#resetNew2').value.trim();
    if(!a || a!==b){ alert('两次输入不一致'); return; }
    const h = await sha256(a);
    localStorage.setItem(LS.pwd, h);
    alert('密码已更新');
    location.reload();
  }
  async function doLogin(){
    const p = $('#loginPwd').value.trim();
    const h = await sha256(p);
    const saved = localStorage.getItem(LS.pwd)||'';
    if(h===saved){
      localStorage.setItem(LS.logged,'1');
      $('#loginView').hidden = true;
      $('#app').hidden = false;
      initUI();
    } else {
      alert('密码错误');
    }
  }
  function logout(){ localStorage.removeItem(LS.logged); location.reload(); }

  // ======== 默认配置 ========
  const defaultConfig = {
    site:{
      title:'Susanne Rasmussen — Independent Investor',
      desc:'Independent investor & financial analyst with 17+ years across FX/derivatives, multi-asset portfolios, and cash-flow real estate. Former Morgan Stanley PWM (11 years).'
    },
    profile:{
      name:'Susanne Rasmussen',
      tagline:'Independent Investor',
      location:'Stockholm, Sweden',
      lead:"I’m an independent investor and financial analyst with 17+ years across foreign‑exchange and derivatives trading, rules‑based multi‑asset portfolio construction, and cash‑flow real estate. Formerly at Morgan Stanley PWM for 11 years, I combine macro judgment with quantitative rules to control drawdowns, manage liquidity, and rebalance with discipline.",
      philo:"I don’t try to predict — I prepare. I translate macro signals into clear rules, allocate assets by purpose, and rebalance with discipline."
    },
    contact:{
      email:'susanne.3363@gmail.com',
      linkedin:'https://se.linkedin.com/in/susanne-rasmussen-68b2b6250',
      wa_digits:'46764791451',
      wa_display:'+46 76 479 1451',
      facebook:'https://www.facebook.com/profile.php?id=100000504557823'
    },
    buttons:{ email:true, linkedin:true, whatsapp:true, facebook:true },
    skills:[
      'Multi‑asset portfolios & rebalancing','Risk budgeting & drawdown control','Liquidity management','Rules‑based execution','Due diligence & post‑trade review',
      'FX & derivatives (USD/EUR/GBP)','Gold, oil, natural gas','Cash‑flow real estate','HNW client coverage','Trade & ops workflows'
    ],
    cards:[
      {t:'Risk First', c:'Protect downside via position sizing, liquidity management, and rule‑based risk controls before seeking returns.'},
      {t:'Macro + Quant', c:'Blend macro judgment with quantitative signals across FX, commodities, and real assets; keep decisions consistent and testable.'},
      {t:'Purposeful Allocation', c:'Assign assets to roles—growth, income, hedge—and rebalance on a set cadence.'}
    ],
    exp:[
      {role:'Independent Investor / Financial Analyst', where:'Stockholm · Europe & Asia', period:'2019–Present', bullets:[
        'Risk‑first, rules‑based FX/derivatives trading blending macro and quantitative signals.',
        'Diversified multi‑asset portfolios with scheduled rebalancing; focus on drawdowns and liquidity.',
        'Manage leased real estate for stable cash flow and long‑term appreciation.',
        'Cross‑jurisdiction due diligence; documented decision rules and post‑trade reviews.'
      ]},
      {role:'Morgan Stanley — Private Wealth Management (HNW)', where:'Stockholm', period:'2008–2019', bullets:[
        'HNW client coverage; cross‑account trading, portfolio management, and operations.',
        'Executed restricted stock and FX liquidity derivatives; USD/EUR/GBP and commodities.',
        'Partnered with Risk & Compliance to streamline workflows and controls.',
        'Developed proposals and portfolio reviews aligned to client goals and risk appetite.'
      ]},
      {role:'Sydkraft — Investment Analyst (Natural Gas Trading)', where:'Malmö', period:'2007–2008', bullets:[
        'Supported natural‑gas trading with monitoring and analysis; contributed to trade operations.',
        'Tracked fundamentals, risk and positions; reporting and coordination.'
      ]}
    ],
    edu:[
      {school:'HEC Paris', line:'EMBA (Part‑time) · Sep 2017 – Sep 2019 · Paris', desc:'Cross‑cultural projects, social‑impact initiatives, leadership workshops, and case competitions (team lead).'},
      {school:'Stockholm School of Economics', line:'M.Sc. in Finance (Part‑time) · Jul 2011 – Jul 2013 · Stockholm', desc:'Technology & Business Club; industry talks; simulations; entrepreneurship workshops.'},
      {school:'University of California, Berkeley', line:'Master’s in Finance (Full‑time) · Sep 2005 – May 2007 · Berkeley, CA', desc:'Accounting Club; management‑accounting seminars with IMA. Returned to Stockholm after graduation.'}
    ],
    avatar:"data:image/svg+xml;utf8,\n<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 600'>\n  <defs><linearGradient id='g' x1='0' x2='1' y1='0' y2='1'><stop stop-color='#e0f2fe' offset='0'/><stop stop-color='#f5f3ff' offset='1'/></linearGradient></defs>\n  <rect width='600' height='600' fill='url(%23g)'/>\n  <circle cx='300' cy='300' r='210' fill='#0f172a'/>\n  <text x='300' y='335' font-family='Segoe UI, Arial' font-weight='700' font-size='180' fill='#fff' text-anchor='middle'>SR</text>\n</svg>",
    favicon:"", // 为空使用默认 SR
    theme:'light'
  };

  let state = JSON.parse(JSON.stringify(defaultConfig));

  // ======== UI 初始化 ========
  function initUI(){
    // Tabs
    const names = ['站点与联系方式','首屏与简介','按钮与技能','经历与教育','预览与发布','数据导入导出'];
    const tabs = $('#tabs');
    names.forEach((n,i)=>{
      const b = document.createElement('button'); b.className='tab'+(i===0?' active':''); b.textContent=n; b.onclick=()=>selectTab(i);
      tabs.appendChild(b);
    });
    selectTab(0);
    // 填充默认或草稿
    const draft = localStorage.getItem(LS.cfg);
    if(draft){ try{ state = JSON.parse(draft);}catch(e){} }
    fillForm();
    // 头像上传
    $('#avatar_file').addEventListener('change', handleAvatarFile);
  }
  function selectTab(i){
    $$('#tabs .tab').forEach((b,idx)=> b.classList.toggle('active', idx===i));
    $$('#sections .section').forEach((s,idx)=> s.classList.toggle('active', idx===i));
  }

  function fillForm(){
    $('#site_title').value = state.site.title;
    $('#site_desc').value = state.site.desc;
    $('#profile_location').value = state.profile.location;

    $('#contact_email').value = state.contact.email;
    $('#contact_linkedin').value = state.contact.linkedin;
    $('#contact_wa_digits').value = state.contact.wa_digits;
    $('#contact_wa_display').value = state.contact.wa_display;
    $('#contact_facebook').value = state.contact.facebook||'';

    $('#profile_name').value = state.profile.name;
    $('#profile_tagline').value = state.profile.tagline;
    $('#profile_lead').value = state.profile.lead;
    $('#profile_philo').value = state.profile.philo;
    $('#avatar_data').value = state.avatar||'';
    $('#favicon_data').value = state.favicon||'';

    $('#btn_email').checked = !!state.buttons.email;
    $('#btn_linkedin').checked = !!state.buttons.linkedin;
    $('#btn_whatsapp').checked = !!state.buttons.whatsapp;
    $('#btn_facebook').checked = !!state.buttons.facebook;

    $('#skills_tags').value = (state.skills||[]).join(', ');

    $('#card1_t').value = state.cards[0].t; $('#card1_c').value = state.cards[0].c;
    $('#card2_t').value = state.cards[1].t; $('#card2_c').value = state.cards[1].c;
    $('#card3_t').value = state.cards[2].t; $('#card3_c').value = state.cards[2].c;

    // 渲染经历与教育列表
    renderExp();
    renderEdu();
  }

  function readForm(){
    state.site.title = $('#site_title').value.trim();
    state.site.desc = $('#site_desc').value.trim();
    state.profile.location = $('#profile_location').value.trim();

    state.contact.email = $('#contact_email').value.trim();
    state.contact.linkedin = $('#contact_linkedin').value.trim();
    state.contact.wa_digits = $('#contact_wa_digits').value.trim();
    state.contact.wa_display = $('#contact_wa_display').value.trim();
    state.contact.facebook = $('#contact_facebook').value.trim();

    state.profile.name = $('#profile_name').value.trim();
    state.profile.tagline = $('#profile_tagline').value.trim();
    state.profile.lead = $('#profile_lead').value.trim();
    state.profile.philo = $('#profile_philo').value.trim();
    state.avatar = $('#avatar_data').value.trim() || defaultConfig.avatar;
    state.favicon = $('#favicon_data').value.trim();

    state.buttons.email = $('#btn_email').checked;
    state.buttons.linkedin = $('#btn_linkedin').checked;
    state.buttons.whatsapp = $('#btn_whatsapp').checked;
    state.buttons.facebook = $('#btn_facebook').checked;

    state.skills = $('#skills_tags').value.split(',').map(s=>s.trim()).filter(Boolean);

    state.cards[0].t = $('#card1_t').value.trim(); state.cards[0].c = $('#card1_c').value.trim();
    state.cards[1].t = $('#card2_t').value.trim(); state.cards[1].c = $('#card2_c').value.trim();
    state.cards[2].t = $('#card3_t').value.trim(); state.cards[2].c = $('#card3_c').value.trim();

    // 从动态列表读取
    state.exp = $$('#exp_list .list-item').map(item=>({
      role: item.querySelector('.exp_role').value.trim(),
      where: item.querySelector('.exp_where').value.trim(),
      period: item.querySelector('.exp_period').value.trim(),
      bullets: item.querySelector('.exp_bullets').value.split('\n').map(s=>s.trim()).filter(Boolean)
    }));
    state.edu = $$('#edu_list .list-item').map(item=>({
      school: item.querySelector('.edu_school').value.trim(),
      line: item.querySelector('.edu_line').value.trim(),
      desc: item.querySelector('.edu_desc').value.trim()
    }));
  }

  function renderExp(){
    const box = $('#exp_list'); box.innerHTML='';
    (state.exp||[]).forEach((e,idx)=>{
      const div = document.createElement('div'); div.className='list-item';
      div.innerHTML = `
        <label>职位 / 公司</label>
        <input class="exp_role" type="text" value="${e.role||''}">
        <label>地点</label>
        <input class="exp_where" type="text" value="${e.where||''}">
        <label>时间</label>
        <input class="exp_period" type="text" value="${e.period||''}">
        <label>要点（每行一条）</label>
        <textarea class="exp_bullets">${(e.bullets||[]).join('\n')}</textarea>
        <div class="right"><button class="btn err" onclick="this.closest('.list-item').remove()">删除</button></div>
      `;
      box.appendChild(div);
    });
  }
  function renderEdu(){
    const box = $('#edu_list'); box.innerHTML='';
    (state.edu||[]).forEach(e=>{
      const div = document.createElement('div'); div.className='list-item';
      div.innerHTML = `
        <label>学校</label><input class="edu_school" type="text" value="${e.school||''}">
        <label>时间/学位</label><input class="edu_line" type="text" value="${e.line||''}">
        <label>描述</label><textarea class="edu_desc">${e.desc||''}</textarea>
        <div class="right"><button class="btn err" onclick="this.closest('.list-item').remove()">删除</button></div>
      `;
      box.appendChild(div);
    });
  }
  function addExp(){ state.exp.push({role:'',where:'',period:'',bullets:[]}); renderExp(); }
  function addEdu(){ state.edu.push({school:'',line:'',desc:''}); renderEdu(); }
  async function handleAvatarFile(e){
    const f = e.target.files[0]; if(!f) return;
    const reader = new FileReader(); reader.onload = ()=>{ $('#avatar_data').value = reader.result; }; reader.readAsDataURL(f);
  }

  // ======== 预览/导出 ========
  function buildHTML(){
    const cfg = state; // 已由 readForm 更新
    const fav = cfg.favicon && cfg.favicon.startsWith('data:') ? cfg.favicon : "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%230f172a'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-family='Segoe UI,Arial' font-size='26' font-weight='700' fill='white'%3ESR%3C/text%3E%3C/svg%3E";
    const btn = cfg.buttons || {};
    const btns = [];
    if(btn.email) btns.push(`<a class="btn-cta btn-email" href="mailto:${cfg.contact.email}">Email</a>`);
    if(btn.linkedin && cfg.contact.linkedin) btns.push(`<a class="btn-cta btn-li" href="${cfg.contact.linkedin}" target="_blank" rel="noopener">LinkedIn</a>`);
    if(btn.whatsapp && cfg.contact.wa_digits) btns.push(`<a class="btn-cta btn-wa" href="https://wa.me/${cfg.contact.wa_digits}" target="_blank" rel="noopener">WhatsApp</a>`);
    if(btn.facebook && cfg.contact.facebook) btns.push(`<a class="btn-cta btn-fb" href="${cfg.contact.facebook}" target="_blank" rel="noopener">Facebook</a>`);

    const skills = (cfg.skills||[]).map(s=>`<span class="pill">${escapeHtml(s)}</span>`).join('');

    const cards = (cfg.cards||[]).map(x=>`
      <div class="card"><h3>${escapeHtml(x.t)}</h3><p>${escapeHtml(x.c)}</p></div>
    `).join('');

    const exp = (cfg.exp||[]).map(x=>`
      <div class="xp-card">
        <div class="xp-head"><h3>${escapeHtml(x.role)}</h3><div class="muted">${escapeHtml(x.where)} · ${escapeHtml(x.period)}</div></div>
        <ul>${(x.bullets||[]).map(b=>`<li>${escapeHtml(b)}</li>`).join('')}</ul>
      </div>
    `).join('');

    const edu = (cfg.edu||[]).map(x=>`
      <div class="card"><h3>${escapeHtml(x.school)}</h3><div class="muted">${escapeHtml(x.line)}</div><p>${escapeHtml(x.desc)}</p></div>
    `).join('');

    const html = `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>${escapeHtml(cfg.site.title)}</title>
<meta name="description" content="${escapeHtml(cfg.site.desc)}">
<link rel="icon" href="${fav}" type="image/svg+xml">
<style>
  :root{--bg:#f6f7fb;--panel:#fff;--text:#0f172a;--muted:#475569;--line:#e5e7eb;--accent:#0ea5e9;--radius:18px;--shadow:0 14px 32px rgba(2,6,23,.08);--max:1100px}
  *{box-sizing:border-box} html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
  .container{max-width:var(--max);margin:0 auto;padding:0 20px}
  header.nav{position:sticky;top:0;z-index:10;background:rgba(246,247,251,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .nav-inner{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
  .anchors a{color:#1f2937;margin-right:16px}
  .hero{display:grid;grid-template-columns:1.2fr 1fr;gap:28px;align-items:center;padding:40px 0 24px}
  .hero h1{font-size:clamp(32px,5vw,52px);line-height:1.1;margin:6px 0 12px}
  .tag{text-transform:uppercase;letter-spacing:.14em;color:#64748b;font-size:12px;margin-bottom:6px}
  .lead{color:var(--muted)} .meta{color:#64748b;font-size:14px;margin:10px 0 18px}
  .photo{background:var(--panel);border-radius:20px;box-shadow:var(--shadow);padding:8px}
  .photo img{width:100%;height:auto;display:block;border-radius:16px}
  section.section{padding:54px 0} .section h2{font-size:clamp(26px,3vw,36px);margin:0 0 14px}
  .muted{color:var(--muted)}
  .cards{display:grid;grid-template-columns:1fr;gap:16px} @media (min-width: 900px){.cards{grid-template-columns:repeat(3,1fr)}}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
  .xp-card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);margin-bottom:16px}
  .xp-head{display:flex;justify-content:space-between;align-items:baseline;gap:12px;flex-wrap: wrap}
  .pill{display:inline-block;font-size:13px;background:#eef2ff;border:1px solid #e5e7eb;padding:6px 10px;border-radius:999px;margin:4px 6px 0 0;color:#1e3a8a}
  .grid-2{display:grid;grid-template-columns:1fr;gap:16px} @media (min-width: 900px){.grid-2{grid-template-columns:1fr 1fr}}
  footer{text-align:center;color:#64748b;padding:40px 0 60px}
  .cta{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .btn-cta{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:999px;font-weight:700;color:#fff;text-decoration:none;box-shadow:0 10px 18px rgba(2,6,23,.15);transition:.2s}
  .btn-cta:hover{transform:translateY(-1px);box-shadow:0 14px 26px rgba(2,6,23,.18)}
  .btn-email{background:linear-gradient(135deg,#f0abfc,#60a5fa)}
  .btn-li{background:linear-gradient(135deg,#1da1f2,#0a66c2)}
  .btn-wa{background:linear-gradient(135deg,#22c55e,#16a34a)}
  .btn-fb{background:linear-gradient(135deg,#60a5fa,#2563eb)}
</style>
</head>
<body>
<header class="nav">
  <div class="container nav-inner">
    <div class="brand">${escapeHtml(cfg.profile.name)}</div>
    <nav class="anchors">
      <a href="#about">About</a>
      <a href="#philosophy">Philosophy</a>
      <a href="#experience">Experience</a>
      <a href="#education">Education</a>
      <a href="#skills">Skills</a>
      <a href="#contact">Contact</a>
    </nav>
  </div>
</header>
<div class="container">
  <section class="hero" id="about">
    <div>
      <div class="tag">${escapeHtml(cfg.profile.tagline)}</div>
      <h1>${escapeHtml(cfg.profile.name)}</h1>
      <p class="lead">${escapeHtml(cfg.profile.lead)}</p>
      <div class="meta">${escapeHtml(cfg.profile.location)} · Industry: ${escapeHtml(cfg.profile.tagline)}</div>
      <div class="cta">${btns.join('')}</div>
    </div>
    <div class="photo"><img src="${cfg.avatar}" alt="Portrait of ${escapeHtml(cfg.profile.name)}" loading="eager" decoding="async"></div>
  </section>
  <section class="section" id="philosophy">
    <h2>Investment Philosophy</h2>
    <p class="muted">${escapeHtml(cfg.profile.philo)}</p>
    <div class="cards">${cards}</div>
  </section>
  <section class="section" id="experience">
    <h2>Professional Experience</h2>
    ${exp}
  </section>
  <section class="section" id="education">
    <h2>Education</h2>
    <div class="grid-2">${edu}</div>
  </section>
  <section class="section" id="skills">
    <h2>Skills</h2>
    <div class="card">${skills}</div>
  </section>
  <section class="section" id="contact">
    <h2>Contact</h2>
    <p class="muted">For investment collaboration, advisory opportunities, or speaking engagements, feel free to reach out.</p>
    <div class="card">
      <p>Email: <a href="mailto:${cfg.contact.email}">${cfg.contact.email}</a></p>
      <p>WhatsApp: <a href="https://wa.me/${cfg.contact.wa_digits}" target="_blank" rel="noopener">${cfg.contact.wa_display}</a></p>
      ${cfg.contact.linkedin?`<p>LinkedIn: <a href="${cfg.contact.linkedin}" target="_blank" rel="noopener">${cfg.contact.linkedin}</a></p>`:''}
      ${cfg.contact.facebook?`<p>Facebook: <a href="${cfg.contact.facebook}" target="_blank" rel="noopener">${cfg.contact.facebook}</a></p>`:''}
    </div>
  </section>
  <footer>© 2025 ${escapeHtml(cfg.profile.name)} · Built with a light, card‑based template.</footer>
</div>
</body>
</html>`;
    return html;
  }

  function escapeHtml(str=''){
    return str.replace(/[&<>\"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]));
  }

  function renderPreview(){
    readForm();
    const html = buildHTML();
    $('#preview').srcdoc = html;
    $('#statusTag').textContent = '已生成预览';
  }
  function downloadHTML(){
    readForm();
    const html = buildHTML();
    const blob = new Blob([html], {type:'text/html;charset=utf-8'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'index.html'; a.click();
    URL.revokeObjectURL(a.href);
  }
  function copyHTML(){
    readForm();
    const html = buildHTML();
    navigator.clipboard.writeText(html).then(()=> alert('已复制 HTML 到剪贴板')); 
  }

  // ======== 草稿存取 ========
  function saveDraft(){ readForm(); localStorage.setItem(LS.cfg, JSON.stringify(state)); alert('已保存到本地'); }
  function loadDraft(){ const d = localStorage.getItem(LS.cfg); if(d){ state = JSON.parse(d); fillForm(); alert('已载入本地草稿'); } else { alert('未找到草稿'); } }
  function clearDraft(){ if(confirm('确认清空本地草稿？')){ localStorage.removeItem(LS.cfg); alert('已清空'); } }
  function exportJSON(){ readForm(); $('#json_out').value = JSON.stringify(state, null, 2); }
  function importJSON(){ try{ const o = JSON.parse($('#json_in').value); state = o; fillForm(); alert('已导入并填充表单'); }catch(e){ alert('JSON 无效'); } }

  // ======== GitHub 提交 ========
  async function publishToGitHub(){
    readForm(); const html = buildHTML();
    const owner = $('#gh_owner').value.trim();
    const repo = $('#gh_repo').value.trim();
    const branch = $('#gh_branch').value.trim()||'main';
    const path = $('#gh_path').value.trim()||'index.html';
    const msg = $('#gh_msg').value.trim()||'update via admin';
    const token = $('#gh_token').value.trim();
    if(!owner||!repo||!token){ $('#gh_status').innerHTML = '<span class="err">缺少 owner / repo / token</span>'; return; }
    $('#gh_status').textContent = '提交中…';
    const contentB64 = btoa(unescape(encodeURIComponent(html)));
    // 先尝试获取现有文件以取得 sha
    let sha = undefined;
    try{
      const r0 = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${branch}`,{headers:{Authorization:`Bearer ${token}`,Accept:'application/vnd.github+json'}});
      if(r0.ok){ const j0 = await r0.json(); sha = j0.sha; }
    }catch(e){}
    const body = { message: msg, content: contentB64, branch }; if(sha) body.sha = sha;
    try{
      const r = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}` ,{
        method:'PUT', headers:{ 'Authorization':`Bearer ${token}`, 'Accept':'application/vnd.github+json' }, body: JSON.stringify(body)
      });
      const j = await r.json();
      if(r.ok){ $('#gh_status').innerHTML = `<span class="ok">已提交：${escapeHtml(j.content.path)} @ ${escapeHtml(j.commit.sha.slice(0,7))}</span>`; }
      else { $('#gh_status').innerHTML = `<span class="err">提交失败：${escapeHtml(j.message||r.statusText)}</span>`; }
    }catch(e){ $('#gh_status').innerHTML = `<span class="err">网络/权限错误：${escapeHtml(String(e))}</span>`; }
  }

  // ======== 启动逻辑 ========
  (function(){
    if(localStorage.getItem(LS.logged)==='1'){
      $('#app').hidden = false; initUI();
    } else { boot(); }
  })();
</script>
</body>
</html>
"""
with open("/mnt/data/admin.html", "w", encoding="utf-8") as f:
    f.write(admin_html)

"/mnt/data/admin.html"